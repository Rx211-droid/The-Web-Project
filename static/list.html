<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GC Analytics Pro Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <style>
        /* Shared Professional Dark/Light Theme Variables */
        :root { /* Dark Mode Defaults */
            --bg-main: #1C2333; --bg-card: #283042; --text-color: #E0E7FF; --text-secondary: #9BA4B5; 
            --accent-color: #5D8AA8; --success-color: #4CAF50; --danger-color: #FF6B6B; --border-color: #3A475C; 
            --shadow-color: rgba(0, 0, 0, 0.3);
        }
        body.light-mode { /* Light Mode Overrides */
            --bg-main: #F4F7FC; --bg-card: #FFFFFF; --text-color: #2D3748; --text-secondary: #A0AEC0;
            --accent-color: #3F51B5; --success-color: #4CAF50; --danger-color: #FF6B6B; --border-color: #E2E8F0;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-main); color: var(--text-color); margin: 0; padding: 0; transition: background-color 0.4s, color 0.4s; line-height: 1.6; }
        .header { background-color: var(--bg-card); border-bottom: 1px solid var(--border-color); padding: 20px; text-align: center; }
        .header h1 { margin: 0; font-size: 1.8em; }
        .container { max-width: 1200px; margin: 30px auto; padding: 0 15px; }

        /* Access Code Input (Visual Focus) */
        .access-box { background-color: var(--bg-card); padding: 30px; border-radius: 12px; margin-bottom: 40px; text-align: center; box-shadow: 0 5px 15px var(--shadow-color); border: 1px solid var(--border-color); }
        .access-box input { padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1.1em; width: 60%; max-width: 300px; background-color: var(--bg-main); color: var(--text-color); margin-right: 10px; }
        .access-box button { padding: 12px 25px; border: none; border-radius: 8px; font-size: 1.1em; background-color: var(--accent-color); color: white; cursor: pointer; transition: background-color 0.2s; }
        .access-box button:hover { background-color: #3f51b5; }
        .access-box p { color: var(--danger-color); font-weight: 600; margin-top: 15px; }

        /* Group List (Amazon-like Grid) */
        .group-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
        .group-card { background-color: var(--bg-card); border-radius: 10px; overflow: hidden; box-shadow: 0 4px 10px var(--shadow-color); cursor: pointer; border: 1px solid var(--border-color); transition: transform 0.2s; }
        .group-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px var(--shadow-color); }
        .group-visual { height: 120px; background-color: var(--accent-color); display: flex; align-items: center; justify-content: center; font-size: 3em; color: white; }
        .group-content { padding: 15px; }
        .group-content h3 { margin-top: 0; margin-bottom: 5px; color: var(--text-color); }
        .group-content p { margin: 0; font-size: 0.9em; color: var(--text-secondary); }
        .tier-tag { font-size: 0.8em; padding: 3px 8px; border-radius: 4px; font-weight: 700; margin-top: 5px; display: inline-block; }
        .tier-elite { background-color: var(--success-color); color: black; }
        .tier-basic { background-color: var(--text-secondary); color: var(--bg-card); }

        @media (max-width: 768px) {
            .access-box input { width: 90%; margin-right: 0; margin-bottom: 10px; }
            .access-box button { width: 90%; }
        }
    </style>
</head>
<body class="dark-mode"> <header class="header">
        <h1>Your Community Management Portal</h1>
        <p style="color: var(--text-secondary);">Access your group's powerful analytics dashboard.</p>
    </header>

    <div class="container">
        
        <div class="access-box">
            <h2>Enter Dashboard Access Code</h2>
            <p style="color: var(--text-secondary);">Received the code from your Telegram bot? Enter it here for instant access.</p>
            <input type="text" id="access-code" placeholder="E.g., PRO-A1">
            <button onclick="resolveCode()">Access Dashboard</button>
            <p id="error-message" style="display: none;">Invalid Code or Access Denied.</p>
        </div>

        <h2>Your Registered Groups (Simulated)</h2>
        <div class="group-grid" id="group-list">
            <p style="color: var(--text-secondary);">Loading registered groups...</p>
        </div>

    </div>

    <script>
        const API_URL_GROUPS = "/api/groups";
        const API_URL_CODE_RESOLVE = "/api/code/";

        // --- THEME SWITCHING (Basic implementation, can be enhanced) ---
        document.body.classList.remove('dark-mode'); 
        const theme = localStorage.getItem('theme') || 'dark';
        if (theme === 'light') { document.body.classList.add('light-mode'); }
        // --- END THEME ---


        async function fetchGroups() {
            try {
                const response = await fetch(API_URL_GROUPS);
                const groups = await response.json();
                const container = document.getElementById('group-list');
                container.innerHTML = ''; // Clear loading text

                groups.forEach(group => {
                    const isElite = group.tier === 'ELITE';
                    const tagClass = isElite ? 'tier-elite' : 'tier-basic';
                    const tagText = isElite ? 'ELITE ðŸš€' : 'BASIC';
                    const memberIcon = isElite ? 'fa-rocket' : 'fa-users';

                    const card = document.createElement('div');
                    card.className = 'group-card';
                    card.onclick = () => window.location.href = `/analytics/${group.id}`;
                    card.innerHTML = `
                        <div class="group-visual" style="background-color: ${isElite ? 'var(--accent-color)' : 'var(--text-secondary)'};">
                            <i class="fas ${memberIcon}"></i>
                        </div>
                        <div class="group-content">
                            <h3>${group.name}</h3>
                            <span class="tier-tag ${tagClass}">${tagText}</span>
                            <p>Code: <b>${group.code}</b></p>
                            <p>Members: ${group.members.toLocaleString()}</p>
                        </div>
                    `;
                    container.appendChild(card);
                });

            } catch (error) {
                console.error('Error fetching groups:', error);
                document.getElementById('group-list').innerHTML = '<p style="color: var(--danger-color);">Could not load group list. Check API server.</p>';
            }
        }
        
        async function resolveCode() {
            const codeInput = document.getElementById('access-code').value;
            const errorMsg = document.getElementById('error-message');
            errorMsg.style.display = 'none';

            if (!codeInput) {
                errorMsg.textContent = "Please enter a code.";
                errorMsg.style.display = 'block';
                return;
            }

            try {
                const response = await fetch(API_URL_CODE_RESOLVE + codeInput);
                const result = await response.json();

                if (response.ok && result.status === 'success') {
                    // Success, redirect to the dashboard
                    window.location.href = `/analytics/${result.chat_id}`;
                } else {
                    errorMsg.textContent = result.message || "Invalid Code or Access Denied.";
                    errorMsg.style.display = 'block';
                }
            } catch (error) {
                errorMsg.textContent = "Network error. Try again.";
                errorMsg.style.display = 'block';
            }
        }

        document.addEventListener('DOMContentLoaded', fetchGroups);
    </script>
</body>
</html>
